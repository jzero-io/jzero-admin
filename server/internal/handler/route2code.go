// Code generated by jzero. DO NOT EDIT.

package handler

import (
	"net/http"
	"path"
	"strings"
	"sync"

	"github.com/zeromicro/go-zero/core/logx"
	"github.com/zeromicro/go-zero/core/search"
)

var RoutesCodesMap = map[string]string{
	"POST:/api/auth/code-login":          "auth:codeLogin",
	"POST:/api/auth/error":               "auth:error",
	"GET:/api/auth/getUserInfo":          "auth:getUserInfo",
	"POST:/api/auth/pwd-login":           "auth:pwdLogin",
	"POST:/api/auth/refreshToken":        "auth:refreshToken",
	"POST:/api/auth/register":            "auth:register",
	"POST:/api/auth/resetPassword":       "auth:resetPassword",
	"GET:/api/auth/sendVerificationCode": "auth:sendVerificationCode",
	"POST:/api/manage/addMenu":           "manage:menu:add",
	"POST:/api/manage/deleteMenu":        "manage:menu:delete",
	"POST:/api/manage/editMenu":          "manage:menu:edit",
	"GET:/api/manage/getAllPages":        "manage:menu:getAllPages",
	"GET:/api/manage/getMenuList/v2":     "manage:menu:list",
	"GET:/api/manage/getMenuTree":        "manage:menu:tree",
	"POST:/api/manage/addRole":           "manage:role:add",
	"POST:/api/manage/deleteRole":        "manage:role:delete",
	"POST:/api/manage/editRole":          "manage:role:edit",
	"GET:/api/manage/getAllRoles":        "manage:role:getAll",
	"GET:/api/manage/getRoleHome":        "manage:role:getHome",
	"GET:/api/manage/getRoleList":        "manage:role:list",
	"GET:/api/manage/getRoleMenus":       "manage:role:getMenus",
	"POST:/api/manage/setRoleMenus":      "manage:role:setMenus",
	"POST:/api/manage/updateRoleHome":    "manage:role:updateHome",
	"POST:/api/manage/addUser":           "manage:user:add",
	"POST:/api/manage/deleteUser":        "manage:user:delete",
	"POST:/api/manage/editUser":          "manage:user:edit",
	"GET:/api/manage/getUserList":        "manage:user:list",
	"GET:/api/route/getConstantRoutes":   "route:getConstantRoutes",
	"GET:/api/route/getUserRoutes":       "route:getUserRoutes",
	"GET:/api/route/isRouteExist":        "route:isRouteExist",
	"GET:/api/version":                   "version:get",
}

var (
	MST  map[string]*search.Tree
	once sync.Once
)

func Route2Code(r *http.Request) string {
	once.Do(func() {
		RegisterRoute2Code(RoutesCodesMap)
	})
	if tree, ok := MST[strings.ToUpper(r.Method)]; ok {
		if result, ok := tree.Search(path.Clean(r.URL.Path)); ok {
			return result.Item.(string)
		}
	}

	return "unknown"
}

func RegisterRoute2Code(maps map[string]string) {
	if MST == nil {
		MST = make(map[string]*search.Tree)
	}
	for k, v := range maps {
		if splits := strings.Split(k, ":"); len(splits) >= 2 {
			if _, ok := MST[splits[0]]; ok {
				logx.Must(MST[splits[0]].Add(path.Clean(strings.Join(splits[1:], ":")), v))
			} else {
				tree := search.NewTree()
				logx.Must(tree.Add(strings.Join(splits[1:], ":"), v))
				MST[splits[0]] = tree
			}
		}
	}
}
